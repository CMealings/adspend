<<<<<<< HEAD
path <- Sys.getenv("TOOLBOX")
path <- Sys.getenv("TOOLBOX")
?Sys.getenv
?Sys.getenv("R_USER")
Sys.getenv("R_USER")
Sys.getenv("TOOLBOX")
Sys.getenv("TOOLBOX")
Sys.getenv("R_USER")
setwd("C:\\Users\\charl\\Documents\\code\\toolbox")
setwd("C:\\Users\\charl\\Documents\\code\\adspend")
openToolbox <- function() {
path <- Sys.getenv("TOOLBOX")
toolbox <- list.files(path)
for (tool in toolbox)
source(paste0(path, "\\", tool))
}
opentoolbox()
openToolbox()
path <- Sys.getenv("TOOLBOX")
toolbox <- list.files(path)
tool <- toolbox[1]
paste0(path, "\\", tool)
source(paste0(path, "\\", tool))
toolbox <- grep(".R", list.files(path))
toolbox <- grep(".R", list.files(path), value = TRUE)
toolbox <- grep(".R$", list.files(path), value = TRUE)
openToolbox()
library(shiny)
.libPaths()
## Dependencies
packages <- c("shiny", "plotly", "shinydashboard")
reqPackages(packages)
openToolbox()
reqPackages(packages)
reqPackages(packages)
openToolbox()
## Dependencies
packages <- c("shiny", "plotly", "shinydashboard")
reqPackages(packages)
.libPaths()
.libpaths()
.libpath()
.libPath()
.libPaths()
## Dependencies
packages <- c("shiny", "plotly", "shinydashboard")
reqPackages(packages)
openToolbox()
reqPackages(packages)
library(shiny)
runApp()
runApp()
runApp()
runApp()
path <- c(data = "E:/Work/")
install.packages("XLConnect")
## Dependencies
scripts <- grep(".R$", list.files(paste0(getwd(), "/scripts/")), value = TRUE)
if (length(scripts) > 0) {
for (func in scripts)
source(paste0(getwd(), "/scripts/", func))
}
library(XLConnect)
wb <- loadworkbook(path$data)
wb <- loadWorkbook(path$data)
wb <- loadWorkbook(path[[data]])
wb <- loadWorkbook(path["data"])
wb <- loadWorkbook(paste0(path["data"], "Global_Int adspend.xlsx"))
paste0(path["data"], "Global_Int adspend.xlsx")
path <- c(data = "F:/Work/")
wb <- loadWorkbook(paste0(path["data"], "Global_Int adspend.xlsx"))
?loadWorkbook
wb <- loadWorkbook(paste0(path["data"], "Global_Int adspend.xlsx", password = "243radar"))
wb <- loadWorkbook(paste0(path["data"], "Global_Int adspend.xlsx"), password = "243radar")
wb <- loadWorkbook(paste0(path["data"], "Global_Int adspend.xlsx"))
=======
path <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/Global_Int adspend.xlsx"
library(XLConnect)
wb <- loadWorkbook(path)
?readWorksheet
data <- readWorksheet(wb, 1, startRow = 23, endRow = 60, startCol = 1, endCol = 55)
View(data)
data <- readWorksheet(wb, 1, startRow = 23, endRow = 60, startCol = 1, endCol = 55, header = FALSE)
View(data)
data <- readWorksheet(wb, 1, startRow = 23, endRow = 60, startCol = 1, endCol = 55, header = FALSE, colTypes = rep("character", 56))
View(data)
warnings()
data <- readWorksheet(wb, 1, startRow = 23, endRow = 60, startCol = 1, endCol = 55, header = FALSE, colTypes = rep("character", 56), useCachedValues = TRUE)
View(data)
data <- readWorksheet(wb, 1, startRow = 23, endRow = 60, startCol = 1, endCol = 55, header = FALSE, useCachedValues = TRUE)
View(data)
data <- readWorksheet(wb, 1, startRow = 23, endRow = 60, startCol = 1, endCol = 55, header = FALSE, colTypes = rep("character", 56), useCachedValues = TRUE)
View(data)
install.packages("readxl")
library(readxl)
?readxl
data <- readWorksheet(wb, 1, startRow = 23, endRow = 60, startCol = 1, endCol = 55, header = FALSE, colTypes = rep("character", 56), keepFormulas = T)
library(xlsx)
data <- read.xlsx(path, keepFormulas = FALSE)
data <- read.xlsx(path, 1, keepFormulas = FALSE)
View(data)
?read.xlsx
data <- read.xlsx(path, 1, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE)
View(data)
data <- read.xlsx(path, 1, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE)
View(data)
data <- readWorksheet(wb, 1, startRow = 23, endRow = 60, startCol = 1, endCol = 55, header = FALSE, colTypes = rep("character", 56))
View(data)
View(data)
data <- read.xlsx(path, 1, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE)
meta <- read.xlsx(path, 1, rowIndex = 15:21, colIndex = 1:55, header = FALSE)
View(data)
colnames(data) <- c("Year", meta[, 15])
View(data)
colnames(data) <- c("Year", meta[15, ])
colnames(data) <- c("Year", meta[15, -1])
View(data)
meta[15, -1]
View(meta)
colnames(data) <- c("Year", meta[2, -1])
View(data)
meta[2, -1]
length(meta[2, -1])
c("Year", meta[2, -1])
colnames(data) <- c("Year", as.character(meta[2, -1]))
View(data)
c("Year", as.character(meta[2, -1]))
meta[2, -1]
as.character(meta[2, -1])
meta <- read.xlsx(path, 1, rowIndex = 15:21, colIndex = 1:55, header = FALSE, colClasses = c(rep("character", 4), rep("numeric", 2)))
colnames(data) <- c("Year", as.character(meta[2, -1]))
View(data)
View(meta)
meta <- read.xlsx(path, 1, rowIndex = 15:21, colIndex = 1:55, header = FALSE, colClasses = "character")
View(meta)
View(meta)
meta[5:7, ] <- apply(meta[, 5:7], 1:2, as.numeric)
meta <- read.xlsx(path, 1, rowIndex = 15:21, colIndex = 1:55, header = FALSE, colClasses = "character")
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
View(meta)
data <- read.xlsx(path, 1, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE, row.names = 1)
View(data)
View(meta)
meta <- read.xlsx(path, 1, rowIndex = 15:21, colIndex = 1:55, header = FALSE, colClasses = "character", row.names = 1)
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
colnames(data) <- as.character(meta[2, -1])
View(data)
View(meta)
claas(meta[2,1])
class(meta[2,1])
meta <- read.xlsx(path, 1, rowIndex = 15:21, colIndex = 1:55, header = FALSE, colClasses = rep("character", 54), row.names = 1)
colnames(data) <- as.character(meta[2, -1])
View(data)
View(meta)
class(meta[2,1])
meta <- read.xlsx(path, 1, rowIndex = 15:21, colIndex = 1:55, header = FALSE, colClasses = rep("character", 55), row.names = 1)
class(meta[2,1])
meta <- read.xlsx(path, 1, rowIndex = 15:21, colIndex = 1:55, header = FALSE, stringsAsFactors = FALSE, row.names = 1)
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
colnames(data) <- as.character(meta[2, -1])
View(meta)
View(data)
View(data)
View(meta)
colnames(data) <- as.character(meta["SeriesCode", -1])
colnames(data) <- meta["SeriesCode", ]
View(data)
path <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/"
datasets <- grep("\\.xlsx$|\\.xlsm$")
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(path))
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(path), value = TRUE)
datasets
grep("^~\$", datasets)
grep("^~$", datasets)
grep("^~\\$", datasets)
grep("^~\\$", datasets, value = )
grep("^~\\$", datasets, value = T)
# exclude temp files
datasets <- datasets[grep("^~\\$", datasets, value = TRUE)]
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets, value = TRUE)]
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets, value = TRUE)]
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(path), value = TRUE)
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets)]
datasets
?xlsx
?list
openToolbox()
View(openToolbox)
path <- Sys.getenv("TOOLBOX")
path <- Sys.getenv("TOOLBOX")
openToolbox()
View(openToolbox)
openToolbox <- function() {
path <- Sys.getenv("TOOLBOX")
toolbox <- grep(".R$", list.files(path), value = TRUE)
for (tool in toolbox)
source(paste0(path, "\\", tool))
}
View(openToolbox)
openToolbox()
reqPackages(c("xlsx", "abind"))
folder <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/"
# list excel datasets
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(folder), value = TRUE)
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets)]
df <- NULL
mf <- NULL
for (wb in datasets) {
browser()
path <- paste0(folder, wb)
sheets <- getSheets(loadWorkbook(path))
sheets <- sheets[!c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts")]
for (sht in sheets) {
data <- read.xlsx(path, sht, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE, row.names = 1)
meta <- read.xlsx(path, sht, rowIndex = 1:21, colIndex = 1:55, header = FALSE, stringsAsFactors = FALSE, row.names = 1)
setName <- meta[1, 1]
dateUpdated <- meta[2, 1]
regionCode <- meta[3, 1]
meta <- meta[15:21, ]
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
meta <- list("setName" = setName, "dateUpdated" = dateUpdated, "regionCode" = regionCode, "meta" = meta)
colnames(data) <- meta["SeriesCode", ]
mf <- abind(mf, meta, along = 3)
df <- abind(df, data, along = 3)
}
}
reqPackages(c("xlsx", "abind"))
folder <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/"
# list excel datasets
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(folder), value = TRUE)
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets)]
df <- NULL
mf <- NULL
for (wb in datasets) {
browser()
path <- paste0(folder, wb)
sheets <- getSheets(loadWorkbook(path))
sheets <- sheets[-c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts")]
for (sht in sheets) {
data <- read.xlsx(path, sht, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE, row.names = 1)
meta <- read.xlsx(path, sht, rowIndex = 1:21, colIndex = 1:55, header = FALSE, stringsAsFactors = FALSE, row.names = 1)
setName <- meta[1, 1]
dateUpdated <- meta[2, 1]
regionCode <- meta[3, 1]
meta <- meta[15:21, ]
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
meta <- list("setName" = setName, "dateUpdated" = dateUpdated, "regionCode" = regionCode, "meta" = meta)
colnames(data) <- meta["SeriesCode", ]
mf <- abind(mf, meta, along = 3)
df <- abind(df, data, along = 3)
}
}
unlist(sheets)
names(sheets)
sheets <- names(getSheets(loadWorkbook(path)))
sheets <- sheets[!c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts")]
sheets <- sheets[sheets != c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts")]
sheets <- sheets[!c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts") %in% sheets]
c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts") %in% sheets
sheets <- names(getSheets(loadWorkbook(path)))
sheets %in% c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts")
sheets <- names(getSheets(loadWorkbook(path)))
sheets <- sheets[!c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts") %in% sheets]
sheets <- names(getSheets(loadWorkbook(path)))
sheets %in% c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts")
sheets
sheets <- names(getSheets(loadWorkbook(path)))
sheets <- sheets[!sheets %in% c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts", "Template")]
reqPackages(c("xlsx", "abind"))
folder <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/"
# list excel datasets
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(folder), value = TRUE)
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets)]
df <- NULL
mf <- NULL
for (wb in datasets) {
browser()
path <- paste0(folder, wb)
sheets <- names(getSheets(loadWorkbook(path)))
sheets <- sheets[!sheets %in% c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts", "Template")]
for (sht in sheets) {
data <- read.xlsx(path, sht, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE, row.names = 1)
meta <- read.xlsx(path, sht, rowIndex = 1:21, colIndex = 1:55, header = FALSE, stringsAsFactors = FALSE, row.names = 1)
setName <- meta[1, 1]
dateUpdated <- meta[2, 1]
regionCode <- meta[3, 1]
meta <- meta[15:21, ]
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
meta <- list("setName" = setName, "dateUpdated" = dateUpdated, "regionCode" = regionCode, "meta" = meta)
colnames(data) <- meta["SeriesCode", ]
mf <- abind(mf, meta, along = 3)
df <- abind(df, data, along = 3)
}
}
reqPackages(c("xlsx", "abind"))
folder <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/"
# list excel datasets
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(folder), value = TRUE)
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets)]
df <- NULL
mf <- NULL
for (wb in datasets) {
path <- paste0(folder, wb)
sheets <- names(getSheets(loadWorkbook(path)))
sheets <- sheets[!sheets %in% c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts", "Template")]
for (sht in sheets) {
browser()
data <- read.xlsx(path, sht, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE, row.names = 1)
meta <- read.xlsx(path, sht, rowIndex = 1:21, colIndex = 1:55, header = FALSE, stringsAsFactors = FALSE, row.names = 1)
setName <- meta[1, 1]
dateUpdated <- meta[2, 1]
regionCode <- meta[3, 1]
meta <- meta[14:21, ]
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
meta <- list("setName" = setName, "dateUpdated" = dateUpdated, "regionCode" = regionCode, "meta" = meta)
colnames(data) <- meta["SeriesCode", ]
mf <- abind(mf, meta, along = 3)
df <- abind(df, data, along = 3)
}
}
View(data)
reqPackages(c("xlsx", "abind"))
folder <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/"
# list excel datasets
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(folder), value = TRUE)
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets)]
df <- NULL
mf <- NULL
for (wb in datasets) {
path <- paste0(folder, wb)
sheets <- names(getSheets(loadWorkbook(path)))
sheets <- sheets[!sheets %in% c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts", "Template")]
for (sht in sheets) {
data <- read.xlsx(path, sht, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE, row.names = 1)
meta <- read.xlsx(path, sht, rowIndex = 1:21, colIndex = 1:55, header = FALSE, stringsAsFactors = FALSE)
row.names(meta) <- meta[, 1]
browser()
setName <- meta[1, 1]
dateUpdated <- meta[2, 1]
regionCode <- meta[3, 1]
meta <- meta[14:21, ]
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
meta <- list("setName" = setName, "dateUpdated" = dateUpdated, "regionCode" = regionCode, "meta" = meta)
colnames(data) <- meta["SeriesCode", ]
mf <- abind(mf, meta, along = 3)
df <- abind(df, data, along = 3)
}
}
reqPackages(c("xlsx", "abind"))
folder <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/"
# list excel datasets
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(folder), value = TRUE)
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets)]
df <- NULL
mf <- NULL
for (wb in datasets) {
path <- paste0(folder, wb)
sheets <- names(getSheets(loadWorkbook(path)))
sheets <- sheets[!sheets %in% c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts", "Template")]
for (sht in sheets) {
data <- read.xlsx(path, sht, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE, row.names = 1)
meta <- read.xlsx(path, sht, rowIndex = 14:21, colIndex = 1:55, header = FALSE, stringsAsFactors = FALSE, row.names = 1)
browser()
countryMeta <- read.xlsx(path, sht, rowIndex = 1:3, colIndex = 1, header = FALSE, stringsAsFactors = FALSE)
setName <- meta[1, 1]
dateUpdated <- meta[2, 1]
regionCode <- meta[3, 1]
meta <- meta[14:21, ]
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
meta <- list("setName" = setName, "dateUpdated" = dateUpdated, "regionCode" = regionCode, "meta" = meta)
colnames(data) <- meta["SeriesCode", ]
mf <- abind(mf, meta, along = 3)
df <- abind(df, data, along = 3)
}
}
x <- read.xlsx(path)
x <- read.xlsx(path,1)
x <- loadWorkbook(path)
?xlread
library(readxl)
?readxl
readWorksheet
?readWorksheet
library(XLConnect)
?readWorksheet
reqPackages(c("xlsx", "abind"))
folder <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/"
# list excel datasets
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(folder), value = TRUE)
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets)]
df <- NULL
mf <- NULL
for (wb in datasets) {
path <- paste0(folder, wb)
file <- loadWorkbook(path)
sheets <- names(getSheets(file))
sheets <- sheets[!sheets %in% c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts", "Template")]
for (sht in sheets) {
# data <- read.xlsx(path, sht, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE, row.names = 1)
data <- readWorksheet(file, sht, startRow = 1, endRow = 60, startCol = 1, endCol = 55, useCachedValues = TRUE, header = FALSE, stringsAsFactors = FALSE)
browser()
# meta <- read.xlsx(path, sht, rowIndex = 14:21, colIndex = 1:55, header = FALSE, stringsAsFactors = FALSE, row.names = 1)
countryMeta <- read.xlsx(path, sht, rowIndex = 1:3, colIndex = 1, header = FALSE, stringsAsFactors = FALSE)
setName <- countryMeta[1, 1]
dateUpdated <- countryMeta[2, 1]
regionCode <- countryMeta[3, 1]
meta <- meta[14:21, ]
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
meta <- list("setName" = setName, "dateUpdated" = dateUpdated, "regionCode" = regionCode, "meta" = meta)
colnames(data) <- meta["SeriesCode", ]
mf <- abind(mf, meta, along = 3)
df <- abind(df, data, along = 3)
}
}
file <- loadWorkbook(path)
folder <- "E:/TYPESET/International Data/Adspend database/Database (NEW FORMAT)/"
# list excel datasets
datasets <- grep("\\.xlsx$|\\.xlsm$", list.files(folder), value = TRUE)
# exclude temp files
datasets <- datasets[-grep("^~\\$", datasets)]
df <- NULL
mf <- NULL
for (wb in datasets) {
path <- paste0(folder, wb)
file <- loadWorkbook(path)
sheets <- names(getSheets(file))
sheets <- sheets[!sheets %in% c("Sheet2", "Sheet3", "Countries", "Asia Pacific Counts", "Africa Counts", "Latin America Counts", "MiddleEast Counts", "Template")]
for (sht in sheets) {
# data <- read.xlsx(path, sht, rowIndex = 23:60, colIndex = 1:55, keepFormulas = FALSE, header = FALSE, row.names = 1)
data <- readWorksheet(file, sht, startRow = 1, endRow = 60, startCol = 1, endCol = 55, useCachedValues = TRUE, header = FALSE, stringsAsFactors = FALSE)
browser()
# meta <- read.xlsx(path, sht, rowIndex = 14:21, colIndex = 1:55, header = FALSE, stringsAsFactors = FALSE, row.names = 1)
countryMeta <- read.xlsx(path, sht, rowIndex = 1:3, colIndex = 1, header = FALSE, stringsAsFactors = FALSE)
setName <- countryMeta[1, 1]
dateUpdated <- countryMeta[2, 1]
regionCode <- countryMeta[3, 1]
meta <- meta[14:21, ]
meta[5:7, ] <- apply(meta[5:7, ], 1:2, as.numeric)
meta <- list("setName" = setName, "dateUpdated" = dateUpdated, "regionCode" = regionCode, "meta" = meta)
colnames(data) <- meta["SeriesCode", ]
mf <- abind(mf, meta, along = 3)
df <- abind(df, data, along = 3)
}
}
>>>>>>> 6cf691b991ea744874a5a42e31af3389d95327ba
